<?xml version="1.0" encoding="UTF-8"?>
<configuration>
    <include resource="org/springframework/boot/logging/logback/defaults.xml"/>

    <!-- Obtener propiedades de Spring Boot -->
    <springProperty scope="context" name="app_name" source="spring.application.name" defaultValue="product-service"/>
    <springProperty scope="context" name="server_port" source="server.port" defaultValue="8080"/>

    <!-- Generar UUID único para esta instancia -->
    <property name="instance_uuid" value="${random.uuid}" />

    <!-- Appender para consola en formato JSON (ÚNICO APRENDER NECESARIO) -->
    <appender name="CONSOLE_JSON" class="ch.qos.logback.core.ConsoleAppender">
        <encoder class="net.logstash.logback.encoder.LogstashEncoder">
            <!-- Todos tus campos personalizados se quedan aquí. ¡Están perfectos! -->
            <customFields>{
                "appname": "${app_name}",
                "version": "1.15",
                "instance_id": "${app_name}-${instance_uuid}",
                "instance_short_id": "${app_name}-${server_port}",
                "server_port": "${server_port}",
                "hostname": "${HOSTNAME}",
                "uuid": "${instance_uuid}"
                }</customFields>
        </encoder>
    </appender>

    <!--
        El root logger ahora solo apunta a la consola JSON.
        Hemos eliminado las referencias a "FILE" y "logstash".
    -->
    <root level="INFO">
        <appender-ref ref="CONSOLE_JSON"/>
    </root>

    <!-- Logger específico para tu aplicación -->
    <logger name="com.ws" level="DEBUG"/>
</configuration>